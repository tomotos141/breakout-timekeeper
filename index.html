<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„Éà„É´„Éº„É† „Çø„Ç§„É†„Ç≠„Éº„Éë„Éº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #f7d794;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #a0a0a0;
        }

        .person-indicator {
            background: #2d3436;
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .person-indicator.active {
            background: #e17055;
        }

        .section-name {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #74b9ff;
            text-shadow: 0 0 20px rgba(116, 185, 255, 0.5);
        }

        .section-description {
            font-size: 1.2rem;
            color: #b2bec3;
            margin-bottom: 30px;
        }

        .timer-display {
            font-size: 8rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }

        .timer-display.warning {
            color: #fdcb6e;
            animation: pulse 1s infinite;
        }

        .timer-display.danger {
            color: #e74c3c;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-bar-container {
            width: 100%;
            height: 10px;
            background: #2d3436;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            transition: width 0.5s ease;
        }

        .progress-bar.warning {
            background: linear-gradient(90deg, #fdcb6e, #e17055);
        }

        .progress-bar.danger {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn-start {
            background: #00b894;
            color: white;
        }

        .btn-start:hover {
            background: #00a381;
            transform: scale(1.05);
        }

        .btn-pause {
            background: #fdcb6e;
            color: #2d3436;
        }

        .btn-pause:hover {
            background: #f9bf3b;
            transform: scale(1.05);
        }

        .btn-next {
            background: #74b9ff;
            color: #2d3436;
        }

        .btn-next:hover {
            background: #5dade2;
            transform: scale(1.05);
        }

        .btn-reset {
            background: #636e72;
            color: white;
        }

        .btn-reset:hover {
            background: #535c60;
            transform: scale(1.05);
        }

        .schedule {
            margin-top: 40px;
            text-align: left;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
        }

        .schedule h3 {
            margin-bottom: 15px;
            color: #f7d794;
        }

        .schedule-item {
            padding: 8px 15px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-item.current {
            background: rgba(116, 185, 255, 0.3);
            border-left: 4px solid #74b9ff;
        }

        .schedule-item.completed {
            opacity: 0.5;
            text-decoration: line-through;
        }

        .schedule-item .time {
            color: #fdcb6e;
            font-weight: bold;
        }

        .complete-screen {
            display: none;
            text-align: center;
        }

        .complete-screen.show {
            display: block;
        }

        .complete-screen h2 {
            font-size: 3rem;
            color: #00b894;
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            cursor: pointer;
        }

        .sound-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ÈÄ≤Ë°åÂõ≥ */
        .flow-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin: 20px 0 30px 0;
            flex-wrap: wrap;
        }

        .flow-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .flow-group-label {
            font-size: 0.75rem;
            color: #a0a0a0;
            white-space: nowrap;
        }

        .flow-group-label.active {
            color: #f7d794;
            font-weight: bold;
        }

        .flow-steps {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .flow-step {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #2d3436;
            border: 2px solid #636e72;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: #636e72;
            transition: all 0.3s ease;
        }

        .flow-step.completed {
            background: #00b894;
            border-color: #00b894;
            color: white;
        }

        .flow-step.current {
            background: #74b9ff;
            border-color: #74b9ff;
            color: white;
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(116, 185, 255, 0.6);
            animation: currentPulse 2s infinite;
        }

        @keyframes currentPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(116, 185, 255, 0.6); }
            50% { box-shadow: 0 0 25px rgba(116, 185, 255, 0.9); }
        }

        .flow-connector {
            width: 20px;
            height: 3px;
            background: #636e72;
        }

        .flow-connector.completed {
            background: #00b894;
        }

        .flow-group-connector {
            width: 30px;
            height: 3px;
            background: #636e72;
            margin: 0 5px;
        }

        .flow-group-connector.completed {
            background: #00b894;
        }

        /* ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„ÉóË©≥Á¥∞ */
        .current-step-detail {
            background: rgba(116, 185, 255, 0.1);
            border: 1px solid rgba(116, 185, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .step-number-large {
            font-size: 1.5rem;
            color: #74b9ff;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <button class="sound-toggle" onclick="toggleSound()">
        üîî „Çµ„Ç¶„É≥„Éâ: <span id="soundStatus">ON</span>
    </button>

    <div class="container">
        <h1>„Éñ„É¨„Ç§„ÇØ„Ç¢„Ç¶„Éà„É´„Éº„É† „Çø„Ç§„É†„Ç≠„Éº„Éë„Éº</h1>

        <div id="mainContent">
            <!-- ÈÄ≤Ë°åÂõ≥ -->
            <div class="flow-diagram" id="flowDiagram"></div>

            <div class="person-indicator" id="personIndicator">
                Ê∫ñÂÇô‰∏≠
            </div>

            <div class="section-name" id="sectionName">ÈñãÂßãÂâç</div>
            <div class="section-description" id="sectionDescription">„Çπ„Çø„Éº„Éà„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>

            <div class="timer-display" id="timerDisplay">00:00</div>

            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 100%"></div>
            </div>

            <div class="progress-info">
                <span id="currentStep">„Çπ„ÉÜ„ÉÉ„Éó: 0 / 0</span>
                <span id="totalTime">ÂêàË®àÊÆã„ÇäÊôÇÈñì: --:--</span>
            </div>

            <div class="controls">
                <button class="btn-start" id="startBtn" onclick="startTimer()">‚ñ∂ „Çπ„Çø„Éº„Éà</button>
                <button class="btn-pause hidden" id="pauseBtn" onclick="pauseTimer()">‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢</button>
                <button class="btn-next hidden" id="nextBtn" onclick="nextSection()">‚è≠ Ê¨°„Å∏„Çπ„Ç≠„ÉÉ„Éó</button>
                <button class="btn-reset" onclick="resetTimer()">‚Ü∫ „É™„Çª„ÉÉ„Éà</button>
            </div>

            <div class="schedule" id="schedule">
                <h3>üìã „Çπ„Ç±„Ç∏„É•„Éº„É´</h3>
                <div id="scheduleList"></div>
            </div>
        </div>

        <div class="complete-screen" id="completeScreen">
            <h2>üéâ „ÅäÁñ≤„ÇåÊßò„Åß„Åó„ÅüÔºÅ</h2>
            <p>ÂÖ®„Å¶„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü</p>
            <button class="btn-reset" onclick="resetTimer()" style="margin-top: 30px;">„ÇÇ„ÅÜ‰∏ÄÂ∫¶Âßã„ÇÅ„Çã</button>
        </div>
    </div>

    <script>
        // „Çπ„Ç±„Ç∏„É•„Éº„É´ÂÆöÁæ©
        const baseSchedule = [
            { name: "‚ë† „Çø„Ç§„É†„Ç≠„Éº„Éë„Éº„ÉªÁô∫Ë°®È†Ü„ÅÆÊ±∫ÂÆö", duration: 2 * 60, person: 0, isSetup: true },
        ];

        // 3‰∫∫ÂàÜ„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥„ÇíËøΩÂä†
        for (let person = 1; person <= 3; person++) {
            baseSchedule.push(
                { name: `‚ë° ‰ºöÁ§æ„Åß„ÅÆÂΩπÂâ≤`, duration: 3 * 60, person: person },
                { name: `‚ë¢ Áõ∏Ë´á‰∫ãÈ†Ö„ÅÆÂÖ±Êúâ`, duration: 5 * 60, person: person },
                { name: `‚ë£ „ÉÅ„Éº„É†„É°„Ç§„Éà„Åã„Çâ„ÅÆ„Ç≥„É°„É≥„Éà`, duration: 10 * 60, person: person },
                { name: `‚ë§ Â≠¶„Å≥„ÉªÊ∞ó„Å•„Åç/babystep„ÅÆÂÖ±Êúâ`, duration: 3 * 60, person: person }
            );
        }

        let schedule = [...baseSchedule];
        let currentIndex = 0;
        let timeRemaining = 0;
        let totalTimeRemaining = 0;
        let timerInterval = null;
        let isPaused = false;
        let soundEnabled = true;

        // Èü≥Â£∞„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playBeep(frequency = 800, duration = 200, times = 1) {
            if (!soundEnabled) return;
            initAudio();

            for (let i = 0; i < times; i++) {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';

                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);

                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration / 1000);
                }, i * (duration + 100));
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundStatus').textContent = soundEnabled ? 'ON' : 'OFF';
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function calculateTotalTime() {
            let total = 0;
            for (let i = currentIndex; i < schedule.length; i++) {
                total += schedule[i].duration;
            }
            total -= (schedule[currentIndex].duration - timeRemaining);
            return total;
        }

        function updateDisplay() {
            const current = schedule[currentIndex];
            const timerDisplay = document.getElementById('timerDisplay');
            const progressBar = document.getElementById('progressBar');
            const sectionName = document.getElementById('sectionName');
            const sectionDescription = document.getElementById('sectionDescription');
            const personIndicator = document.getElementById('personIndicator');

            // „Çª„ÇØ„Ç∑„Éß„É≥Âêç„ÇíÊõ¥Êñ∞
            sectionName.textContent = current.name;

            // ‰∫∫„ÅÆË°®Á§∫
            if (current.isSetup) {
                personIndicator.textContent = 'Ê∫ñÂÇô';
                personIndicator.classList.remove('active');
                sectionDescription.textContent = '„Çø„Ç§„É†„Ç≠„Éº„Éë„Éº„Å®Áô∫Ë°®È†Ü„ÇíÊ±∫„ÇÅ„Å¶„Åè„Å†„Åï„ÅÑ';
            } else {
                personIndicator.textContent = `${current.person}‰∫∫ÁõÆ„ÅÆÁô∫Ë°®`;
                personIndicator.classList.add('active');
                sectionDescription.textContent = `${current.person}‰∫∫ÁõÆ„ÅÆ„Çª„ÉÉ„Ç∑„Éß„É≥`;
            }

            // „Çø„Ç§„Éû„ÉºË°®Á§∫
            timerDisplay.textContent = formatTime(timeRemaining);

            // ÈÄ≤Êçó„Éê„Éº
            const progress = (timeRemaining / current.duration) * 100;
            progressBar.style.width = `${progress}%`;

            // Ë≠¶ÂëäÁä∂ÊÖã
            timerDisplay.classList.remove('warning', 'danger');
            progressBar.classList.remove('warning', 'danger');

            if (timeRemaining <= 10) {
                timerDisplay.classList.add('danger');
                progressBar.classList.add('danger');
            } else if (timeRemaining <= 30) {
                timerDisplay.classList.add('warning');
                progressBar.classList.add('warning');
            }

            // „Çπ„ÉÜ„ÉÉ„ÉóÊÉÖÂ†±
            document.getElementById('currentStep').textContent =
                `„Çπ„ÉÜ„ÉÉ„Éó: ${currentIndex + 1} / ${schedule.length}`;
            document.getElementById('totalTime').textContent =
                `ÂêàË®àÊÆã„ÇäÊôÇÈñì: ${formatTime(calculateTotalTime())}`;

            // „Çπ„Ç±„Ç∏„É•„Éº„É´‰∏ÄË¶ß„ÇíÊõ¥Êñ∞
            updateScheduleList();

            // ÈÄ≤Ë°åÂõ≥„ÇíÊõ¥Êñ∞
            updateFlowDiagram();
        }

        function updateScheduleList() {
            const list = document.getElementById('scheduleList');
            list.innerHTML = '';

            schedule.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'schedule-item';

                if (index < currentIndex) {
                    div.classList.add('completed');
                } else if (index === currentIndex) {
                    div.classList.add('current');
                }

                const personText = item.isSetup ? '' : ` [${item.person}‰∫∫ÁõÆ]`;
                div.innerHTML = `
                    <span>${item.name}${personText}</span>
                    <span class="time">${Math.floor(item.duration / 60)}ÂàÜ</span>
                `;

                list.appendChild(div);
            });
        }

        function updateFlowDiagram() {
            const diagram = document.getElementById('flowDiagram');
            diagram.innerHTML = '';

            // „Ç∞„É´„Éº„ÉóÂÆöÁæ©: Ê∫ñÂÇô + 3‰∫∫ÂàÜ
            const groups = [
                { label: 'Ê∫ñÂÇô', indices: [0], steps: ['‚ë†'] },
                { label: '1‰∫∫ÁõÆ', indices: [1, 2, 3, 4], steps: ['‚ë°', '‚ë¢', '‚ë£', '‚ë§'] },
                { label: '2‰∫∫ÁõÆ', indices: [5, 6, 7, 8], steps: ['‚ë°', '‚ë¢', '‚ë£', '‚ë§'] },
                { label: '3‰∫∫ÁõÆ', indices: [9, 10, 11, 12], steps: ['‚ë°', '‚ë¢', '‚ë£', '‚ë§'] }
            ];

            groups.forEach((group, groupIndex) => {
                // „Ç∞„É´„Éº„ÉóÈñì„ÅÆ„Ç≥„Éç„ÇØ„Çø„Éº
                if (groupIndex > 0) {
                    const connector = document.createElement('div');
                    connector.className = 'flow-group-connector';
                    // Ââç„ÅÆ„Ç∞„É´„Éº„Éó„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Åü„ÇâÂÆå‰∫ÜËâ≤„Å´
                    const prevGroup = groups[groupIndex - 1];
                    const prevGroupCompleted = prevGroup.indices.every(i => i < currentIndex);
                    if (prevGroupCompleted) {
                        connector.classList.add('completed');
                    }
                    diagram.appendChild(connector);
                }

                const groupDiv = document.createElement('div');
                groupDiv.className = 'flow-group';

                // „Ç∞„É´„Éº„Éó„É©„Éô„É´
                const label = document.createElement('div');
                label.className = 'flow-group-label';
                const isGroupActive = group.indices.includes(currentIndex);
                if (isGroupActive) {
                    label.classList.add('active');
                }
                label.textContent = group.label;
                groupDiv.appendChild(label);

                // „Çπ„ÉÜ„ÉÉ„Éó„ÅÆ„Ç≥„É≥„ÉÜ„Éä
                const stepsDiv = document.createElement('div');
                stepsDiv.className = 'flow-steps';

                group.indices.forEach((scheduleIndex, stepIndex) => {
                    // „Çπ„ÉÜ„ÉÉ„ÉóÈñì„ÅÆ„Ç≥„Éç„ÇØ„Çø„Éº
                    if (stepIndex > 0) {
                        const connector = document.createElement('div');
                        connector.className = 'flow-connector';
                        if (scheduleIndex <= currentIndex) {
                            connector.classList.add('completed');
                        }
                        stepsDiv.appendChild(connector);
                    }

                    const step = document.createElement('div');
                    step.className = 'flow-step';
                    step.textContent = group.steps[stepIndex];

                    if (scheduleIndex < currentIndex) {
                        step.classList.add('completed');
                    } else if (scheduleIndex === currentIndex) {
                        step.classList.add('current');
                    }

                    stepsDiv.appendChild(step);
                });

                groupDiv.appendChild(stepsDiv);
                diagram.appendChild(groupDiv);
            });
        }

        function startTimer() {
            initAudio();

            if (currentIndex === 0 && timeRemaining === 0) {
                timeRemaining = schedule[0].duration;
            }

            isPaused = false;
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('pauseBtn').classList.remove('hidden');
            document.getElementById('nextBtn').classList.remove('hidden');

            timerInterval = setInterval(() => {
                if (!isPaused) {
                    timeRemaining--;
                    updateDisplay();

                    // 30ÁßíÂâç„ÅÆË≠¶ÂëäÈü≥
                    if (timeRemaining === 30) {
                        playBeep(600, 150, 2);
                    }

                    // 10ÁßíÂâç„ÅÆ„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥Èü≥
                    if (timeRemaining <= 10 && timeRemaining > 0) {
                        playBeep(800, 100, 1);
                    }

                    if (timeRemaining <= 0) {
                        playBeep(1000, 300, 3);
                        nextSection();
                    }
                }
            }, 1000);

            updateDisplay();
        }

        function pauseTimer() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = isPaused ? '‚ñ∂ ÂÜçÈñã' : '‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢';
        }

        function nextSection() {
            currentIndex++;

            if (currentIndex >= schedule.length) {
                // ÂÆå‰∫Ü
                clearInterval(timerInterval);
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('completeScreen').classList.add('show');
                playBeep(1200, 200, 5);
                return;
            }

            timeRemaining = schedule[currentIndex].duration;
            updateDisplay();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            currentIndex = 0;
            timeRemaining = 0;
            isPaused = false;

            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('completeScreen').classList.remove('show');
            document.getElementById('startBtn').classList.remove('hidden');
            document.getElementById('pauseBtn').classList.add('hidden');
            document.getElementById('pauseBtn').textContent = '‚è∏ ‰∏ÄÊôÇÂÅúÊ≠¢';
            document.getElementById('nextBtn').classList.add('hidden');

            document.getElementById('sectionName').textContent = 'ÈñãÂßãÂâç';
            document.getElementById('sectionDescription').textContent = '„Çπ„Çø„Éº„Éà„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('timerDisplay').classList.remove('warning', 'danger');
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('progressBar').classList.remove('warning', 'danger');
            document.getElementById('personIndicator').textContent = 'Ê∫ñÂÇô‰∏≠';
            document.getElementById('personIndicator').classList.remove('active');

            updateScheduleList();
            updateFlowDiagram();
        }

        // ÂàùÊúüÂåñ
        updateScheduleList();
        updateFlowDiagram();
    </script>
</body>
</html>
